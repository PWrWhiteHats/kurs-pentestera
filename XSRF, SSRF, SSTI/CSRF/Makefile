# Define variables
HOST_IMAGE_NAME := vulnerable-csrf-app
HOST_CONTAINER_NAME := vulnerable-csrf-app-container
HOST_PORT := 727

ATTACKER_IMAGE_NAME := attacker-csrf-app
ATTACKER_CONTAINER_NAME := attacker-app-container
ATTACKER_PORT := 728

.PHONY: start build run clean

start: build run

build:
	# Build Docker image
	docker build -t $(HOST_IMAGE_NAME) -f Dockerfile-host .
	docker build -t $(ATTACKER_IMAGE_NAME) -f Dockerfile-attacker .

run:
	# Run Docker container
	docker run -d -p $(HOST_PORT):80 --name $(HOST_CONTAINER_NAME) $(HOST_IMAGE_NAME)
	docker run -d -p $(ATTACKER_PORT):80 --name $(ATTACKER_CONTAINER_NAME) $(ATTACKER_IMAGE_NAME)

clean:
	# Stop and remove Docker container
	docker stop $(HOST_CONTAINER_NAME) || true
	docker stop $(ATTACKER_CONTAINER_NAME) || true
	docker rm $(HOST_CONTAINER_NAME) || true
	docker rm $(ATTACKER_CONTAINER_NAME) || true
